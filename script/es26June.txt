get_age_by_autore se fosse una procedura:
USE biblioteca;
DELIMITER //

CREATE PROCEDURE get_age_by_autore(nome VARCHAR(250), cognome VARCHAR(250))
BEGIN
    DECLARE idAutore INT;
    DECLARE eta INT;
    
    SET idAutore = NULL;
    SELECT codiceA INTO idAutore FROM autori
    WHERE CognomeA = cognome AND NomeA = nome;
    
    IF idAutore IS NULL THEN
        SELECT "Autore non censito";
    ELSE
        SET eta = YEAR(CURRENT_DATE) - YEAR(annoN);
        SELECT CONCAT("L'età dell'autore ", nome, " ", cognome, " è pari a ", eta);
    END IF;
END //

DELIMITER ;


Funzione get_age_by_autore:
use biblioteca;
DROP FUNCTION IF EXISTS get_age_by_autore;

DELIMITER //

CREATE FUNCTION get_age_by_autore(nome VARCHAR(250), cognome VARCHAR(250)) RETURNS INT
READS SQL DATA
BEGIN
    DECLARE idAutore INT;
    DECLARE eta INT;
    DECLARE anno_nascita INT;
    DECLARE anno_morte INT;
    
    SET idAutore = NULL;
    SELECT codiceA INTO idAutore FROM autori
    WHERE CognomeA = cognome AND NomeA = nome;
    
    IF idAutore IS NULL THEN
        RETURN NULL;
    ELSE
        SET anno_nascita = NULL;
        SET anno_morte = NULL;
        
        SELECT AnnoN INTO anno_nascita FROM autori
        WHERE CognomeA = cognome AND NomeA = nome;
        
        SELECT AnnoM INTO anno_morte FROM autori
        WHERE CognomeA = cognome AND NomeA = nome;
        
        IF anno_morte IS NOT NULL THEN
            RETURN -1; -- Autore deceduto
        ELSE
            SET eta = YEAR(CURRENT_DATE) - anno_nascita;
            RETURN eta;
        END IF;
    END IF;
END //

DELIMITER ;





Chiamare la funzione:
SELECT get_age_by_autore('Alessandro', 'Manzoni') AS eta_autore;






Procedura get_age_autori_nazione:
use biblioteca;
DELIMITER //
DROP PROCEDURE IF EXISTS get_age_autori_nazione //
CREATE PROCEDURE get_age_autori_nazione(
	IN nazioneA VARCHAR(100))
BEGIN
	DECLARE annoMorte INT;
    
    DROP TABLE IF EXISTS autori_eta_temp;
    CREATE TABLE autori_eta_temp (
        nome VARCHAR(250),
        cognome VARCHAR(250),
        eta INT
    );
    
	INSERT INTO autori_eta_temp (nome, cognome, eta)
	SELECT NomeA, CognomeA, get_age_by_autore(NomeA, CognomeA)
	FROM autori
	WHERE Nazione = nazioneA;
    
    SELECT nome, cognome, eta
    FROM autori_eta_temp;
    
    DROP TABLE IF EXISTS autori_eta_temp;
END //
DELIMITER ;